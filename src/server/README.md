# æœåŠ¡å™¨ä»£ç ç»“æ„è¯´æ˜

## ä»£ç æ‹†åˆ†å®ŒæˆçŠ¶æ€

### âœ… å·²å®Œæˆçš„æ‹†åˆ†

#### æ ¸å¿ƒæ¨¡å—
- **`state.rs`** - åŒ…å« `ServerState` ç»“æ„ä½“å’ŒçŠ¶æ€åˆå§‹åŒ–é€»è¾‘
- **`types.rs`** - åŒ…å« `ApiResponse<T>` å’Œå„ç§è¯·æ±‚/å“åº”ç±»å‹å®šä¹‰
- **`errors.rs`** - åŒ…å« `handle_rejection` é”™è¯¯å¤„ç†å‡½æ•°
- **`utils.rs`** - åŒ…å« `with_state` ç­‰å·¥å…·å‡½æ•°

#### è·¯ç”±æ¨¡å— (æŒ‰åŠŸèƒ½åˆ†ç»„)

**åŸºç¡€ä¸çŠ¶æ€è·¯ç”±**
- `health.rs` - å¥åº·æ£€æŸ¥å’ŒåŸºç¡€æŒ‡æ ‡
- `state_metrics.rs` - çŠ¶æ€æŒ‡æ ‡å’Œå‘Šè­¦

**IPFS ä¸æ‰©å±•è·¯ç”±**
- `ipfs_cache.rs` - IPFSç¼“å­˜ç®¡ç†
- `ipfs_ext.rs` - IPFSæ‰©å±•åŠŸèƒ½
- `upload.rs` - æ–‡ä»¶ä¸Šä¼ 

**NFT ä¸æŠ½å¥–è·¯ç”±**
- `nft_types.rs` - NFTç±»å‹ç®¡ç†
- `nft_ownership.rs` - NFTæ‰€æœ‰æƒç®¡ç†
- `lottery_config.rs` - æŠ½å¥–é…ç½®ç®¡ç†
- `levels.rs` - æŠ½å¥–ç­‰çº§ç®¡ç†
- `nft_state.rs` - NFTçŠ¶æ€ç®¡ç†

**æƒé™ä¸è´¨æŠ¼è·¯ç”±**
- `permissions.rs` - æƒé™ç®¡ç†
- `staking.rs` - è´¨æŠ¼ç®¡ç†
- `qualification.rs` - èµ„æ ¼ç®¡ç†
- `stake_events.rs` - è´¨æŠ¼äº‹ä»¶

**æ ¸å¿ƒåŠŸèƒ½è·¯ç”±**
- `voting.rs` - æŠ•ç¥¨ç³»ç»Ÿ
- `sync.rs` - åŒæ­¥åŠŸèƒ½
- `tools.rs` - å·¥å…·å‡½æ•°
- `cache.rs` - ç¼“å­˜ç®¡ç†
- `serials.rs` - åºå·ç®¡ç†

#### æµ‹è¯•ç›®å½•
- `tests/unit_tests.rs` - å•å…ƒæµ‹è¯•
- `tests/integration_tests.rs` - é›†æˆæµ‹è¯•
- `tests/test_helpers.rs` - æµ‹è¯•è¾…åŠ©å‡½æ•°

### ğŸ”§ ä¸»è¦æ”¹è¿›

1. **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**: å°† `ServerState` çš„åˆ›å»ºé€»è¾‘ç§»åˆ° `state.rs` ä¸­ï¼Œæä¾› `ServerState::new()` å·¥å‚å‡½æ•°
2. **main.rs ç®€åŒ–**: ç§»é™¤äº†å¤§é‡çŠ¶æ€åˆå§‹åŒ–ä»£ç ï¼Œç°åœ¨åªè´Ÿè´£æœåŠ¡å™¨å¯åŠ¨å’Œè·¯ç”±é…ç½®
3. **æ¨¡å—ç»„ç»‡**: æŒ‰åŠŸèƒ½å¯¹è·¯ç”±æ¨¡å—è¿›è¡Œåˆ†ç»„ï¼Œä½¿ç»“æ„æ›´æ¸…æ™°
4. **ä¾èµ–ç®¡ç†**: ä¼˜åŒ–äº†æ¨¡å—é—´çš„å¯¼å…¥å…³ç³»

### ğŸ“ æ–‡ä»¶ç»“æ„

```
src/server/src/
â”œâ”€â”€ main.rs              # æœåŠ¡å™¨ä¸»ç¨‹åºï¼ˆå·²ç®€åŒ–ï¼‰
â”œâ”€â”€ state.rs             # æœåŠ¡å™¨çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types.rs             # ç±»å‹å®šä¹‰
â”œâ”€â”€ errors.rs            # é”™è¯¯å¤„ç†
â”œâ”€â”€ utils.rs             # å·¥å…·å‡½æ•°
â”œâ”€â”€ core/                # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ routes/              # è·¯ç”±æ¨¡å—
â”‚   â”œâ”€â”€ mod.rs          # è·¯ç”±æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ health.rs       # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ state_metrics.rs # çŠ¶æ€æŒ‡æ ‡
â”‚   â”œâ”€â”€ ipfs_cache.rs   # IPFSç¼“å­˜
â”‚   â”œâ”€â”€ ipfs_ext.rs     # IPFSæ‰©å±•
â”‚   â”œâ”€â”€ upload.rs       # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ nft_types.rs    # NFTç±»å‹
â”‚   â”œâ”€â”€ nft_ownership.rs # NFTæ‰€æœ‰æƒ
â”‚   â”œâ”€â”€ lottery_config.rs # æŠ½å¥–é…ç½®
â”‚   â”œâ”€â”€ levels.rs       # æŠ½å¥–ç­‰çº§
â”‚   â”œâ”€â”€ permissions.rs  # æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ staking.rs      # è´¨æŠ¼ç®¡ç†
â”‚   â”œâ”€â”€ qualification.rs # èµ„æ ¼ç®¡ç†
â”‚   â”œâ”€â”€ voting.rs       # æŠ•ç¥¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ sync.rs         # åŒæ­¥åŠŸèƒ½
â”‚   â”œâ”€â”€ tools.rs        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ cache.rs        # ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ nft_state.rs    # NFTçŠ¶æ€
â”‚   â”œâ”€â”€ stake_events.rs # è´¨æŠ¼äº‹ä»¶
â”‚   â””â”€â”€ serials.rs      # åºå·ç®¡ç†
â””â”€â”€ tests/               # æµ‹è¯•ç›®å½•
    â”œâ”€â”€ mod.rs          # æµ‹è¯•æ¨¡å—å¯¼å‡º
    â”œâ”€â”€ unit_tests.rs   # å•å…ƒæµ‹è¯•
    â”œâ”€â”€ integration_tests.rs # é›†æˆæµ‹è¯•
    â””â”€â”€ test_helpers.rs # æµ‹è¯•è¾…åŠ©å‡½æ•°
```

### ğŸš€ ä½¿ç”¨è¯´æ˜

1. **å¯åŠ¨æœåŠ¡å™¨**: ç›´æ¥è¿è¡Œ `cargo run` å³å¯å¯åŠ¨
2. **æ·»åŠ æ–°è·¯ç”±**: åœ¨ `routes/` ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼Œå¹¶åœ¨ `routes/mod.rs` ä¸­å¯¼å‡º
3. **çŠ¶æ€ç®¡ç†**: é€šè¿‡ `ServerState::new()` åˆ›å»ºæ–°çš„æœåŠ¡å™¨çŠ¶æ€
4. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `handle_rejection` ç»Ÿä¸€å¤„ç†é”™è¯¯

### ğŸ“ æ³¨æ„äº‹é¡¹

- æ‰€æœ‰è·¯ç”±æ¨¡å—éƒ½åº”è¯¥ä½¿ç”¨ `with_state` æ¥è·å–æœåŠ¡å™¨çŠ¶æ€
- æ–°å¢ç±»å‹å®šä¹‰åº”æ”¾åœ¨ `types.rs` ä¸­
- é”™è¯¯å¤„ç†åº”é€šè¿‡ `errors.rs` ä¸­çš„å‡½æ•°è¿›è¡Œ
- æµ‹è¯•æ–‡ä»¶ä¸­çš„å¯¼å…¥è·¯å¾„å·²æ­£ç¡®é…ç½®
